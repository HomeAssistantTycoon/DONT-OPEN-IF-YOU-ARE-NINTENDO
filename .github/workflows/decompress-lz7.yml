name: LZ7 → SZS/ARC Extract

on:
  workflow_dispatch:            # Manual trigger [oai_citation:14‡docs.github.com](https://docs.github.com/en/actions/how-tos/manage-workflow-runs/manually-run-a-workflow#:~:text=When%20a%20workflow%20is%20configured,CLI%2C%20or%20the%20REST%20API)

jobs:
  extract:
    runs-on: ubuntu-latest      # GitHub-hosted Ubuntu runner

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Download Wiimm SZS Tools
        run: |
          wget https://szs.wiimm.de/szs-v2.42a-r8989-x86_64.tar.gz
          tar -xzf szs-v2.42a-r8989-x86_64.tar.gz
          sudo cp szs-v2.42a-r8989/bin/* /usr/local/bin/

      - name: Setup Python tools
        run: pip install ndspy

      - name: Decompress LZ7 (LZ10)
        run: |
          mkdir -p decompressed
          python3 -m ndspy.lz10 decompress path/to/input.lz7 decompressed/output.bin \
            || { echo "Error: Decompression failed" >&2; exit 1; }

      - name: Check archive format
        run: |
          FILE=decompressed/output.bin
          magic=$(head -c4 "$FILE")
          if [[ "$magic" != "Yaz0" && "$magic" != "RARC" ]]; then
            echo "Error: File is not SZS or RARC (magic=$magic)." >&2
            exit 1
          fi

      - name: Extract contents
        run: |
          mkdir -p output
          wszst extract decompressed/output.bin -D output

      - name: List output files
        run: ls -R output
